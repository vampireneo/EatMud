<!DOCTYPE html>
<html lang="en" manifest="eatmud.appcache">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="apple-touch-icon" href="favicon.ico">
    <link href="favicon.ico" rel="icon" type="image/x-icon" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <title>食乜好?</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      #footer {
        margin-top: 100px;
        padding-left: 10px;
        padding-top: 5px;
        padding-bottom: 5px;
      }
    </style>
  </head>
  <body>
  	<div class="container">
	  	<div class="page-header">
	  		<h1>食乜好?</h1>

    <div class="well">
      <h1 id="shopName" class="text-center">Loading...</h1>
      <p id="shopAddress" class="text-center"></p>
    </div>

    <div class="row">
      <button type="button" id="suggestButton" class="btn btn-primary col-xs-3 col-xs-offset-2" data-loading-text="Loading..." autocomplete="off">下個提議</button>
      <a type="button" id="whatsappButton" class="btn btn-success col-xs-3 col-xs-offset-2" data-loading-text="Loading..." autocomplete="off"  role="button" href="whatsapp://send?text=" data-href=".">Whatsapp</a>
    </div>

    <p class="bg-info" id="footer">Feel free to update the database at <a href="https://docs.google.com/spreadsheets/d/1hlSuO5Fn4bcEcFSrvT9EEQ0GFZ4lpF9tDihUCalgsIU/edit?usp=sharing">Google Drive</a><br/><br/>
      You can add this page in homepage of your mobile as a web app.</p>
    </div>
		</div>



    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery-1.11.2.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        suggest();
      });

      $("#suggestButton").on('click', function () {
        var $btn = $(this).button('loading')
        suggest();
        $btn.button('reset');
      });

      function suggest() {
        $("#shopName").text("Loading...");
        $("#shopAddress").text("");
        $.ajax({
          type: "get",
          async: false,
          url: "https://spreadsheets.google.com/feeds/list/1hlSuO5Fn4bcEcFSrvT9EEQ0GFZ4lpF9tDihUCalgsIU/od6/public/values?alt=json-in-script",
          dataType: "jsonp",//指定以jsonp方式執行
          jsonp: "callback",//"mycallback"會以GET的變數名稱傳送，沒指定時，jQuery使用"callback"當變數名稱
          success: function(data){
            document.tmp = data;
            //console.log(data);
            var idx = Math.floor(Math.random()*data.feed.entry.length);
            var shopName = data.feed.entry[idx].gsx$shop.$t;
            var shopAddress = data.feed.entry[idx].gsx$address.$t;
            $("#shopName").text(shopName);
            $("#shopAddress").text(shopAddress);
            $("#whatsappButton").attr("href", "whatsapp://send?text=" + shopName + ", " + shopAddress);
            return false;
          },
          error: function(){
            alert('fail to load data');
          }
        });
      }

      // Check if a new cache is available on page load.
      window.addEventListener('load', function(e) {
        window.applicationCache.addEventListener('updateready', function(e) {
          if (window.applicationCache.status == window.applicationCache.UPDATEREADY) {
            // Browser downloaded a new app cache.
            if (confirm('A new version of this site is available. Load it?')) {
              window.location.reload();
            }
          } else {
            // Manifest didn't changed. Nothing new to server.
          }
        }, false);
      }, false);
    </script>
  </body>
</html>
